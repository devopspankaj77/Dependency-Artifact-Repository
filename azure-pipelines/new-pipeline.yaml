trigger:
  branches:
    include:
      - main

parameters:
  - name: nodeVersion
    displayName: "Select Node Version"
    type: string
    default: '18'
    values:
      - '16'
      - '18'
      - '20'

pool: Default


variables:
  storageAccountName: 'mystorageaccount'
  containerName: 'node-deps'
  blobFileName: 'node$(nodeVersion).zip'
  workDir: '$(System.DefaultWorkingDirectory)'

steps:
# 1Ô∏è‚É£ Node install karo (parameter se version)
- task: NodeTool@0
  inputs:
    versionSpec: ${{ parameters.nodeVersion }}
  displayName: 'Install Node.js $(nodeVersion)'

# 2Ô∏è‚É£ Dependencies install karo
- script: |
    echo "üì¶ Installing dependencies..."
    npm install
  displayName: 'Install dependencies'

# 3Ô∏è‚É£ DevDependencies hatao aur zip banao
- script: |
    echo "üßπ Cleaning dev dependencies..."
    npm prune --production
    zip -r node${{ parameters.nodeVersion }}.zip node_modules/
  displayName: 'Clean and Package dependencies'

# # 4Ô∏è‚É£ Azure CLI task se Blob upload karo
# - task: AzureCLI@2
#   inputs:
#     azureSubscription: 'MyAzureServiceConnection'   # <-- yahan apna service connection name daalna
#     scriptType: 'bash'
#     scriptLocation: 'inlineScript'
#     inlineScript: |
#       echo "‚òÅÔ∏è Uploading to Blob Storage..."
#       az storage blob upload \
#         --account-name $(storageAccountName) \
#         --container-name $(containerName) \
#         --file node${{ parameters.nodeVersion }}.zip \
#         --name node${{ parameters.nodeVersion }}.zip \
#         --overwrite true
#   displayName: 'Upload cleaned deps to Azure Blob'
